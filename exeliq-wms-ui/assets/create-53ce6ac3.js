import{_ as $,r as v,y as w,T as P,R as L,j as t,V as ee,F as s,L as te,E as Q,J as U,m as ae,n as d,S as h,I as g,p as le,aT as ie,C as se,aU as ne,z as A,A as N}from"./index-7ade8dfe.js";const re=()=>{var E,k;const l=$(),[F,T]=v.useState([]),[G,I]=v.useState(0),[H,V]=v.useState(w),[M,b]=v.useState(!1),{formProps:e,saveButtonProps:B}=P(),{selectProps:D,queryResult:j}=L({resource:"joborders",optionLabel:"order_no",optionValue:"id"}),{selectProps:z}=L({resource:"customers",optionLabel:"name",optionValue:"id"}),{selectProps:K,queryResult:C}=L({resource:"products",optionLabel:"name",optionValue:"id",filters:[{field:"product_type",operator:"ne",value:"RAW MATERIAL"}]}),{selectProps:O}=L({resource:"machines",optionLabel:"name",optionValue:"id"}),J=a=>{var u,r,p,_,y,n,m,c,f,o,q,R,W;if("product"in a){const x=(u=e==null?void 0:e.form)==null?void 0:u.getFieldValue("unit_type"),i=(r=C.data)==null?void 0:r.data.find(Z=>Z.id===a.product.id);(p=e==null?void 0:e.form)==null||p.setFieldsValue({unit_type:i==null?void 0:i.unit_type,unit_weight_type:i==null?void 0:i.unit_weight_type,unit_weight:i==null?void 0:i.unit_weight}),x!==(i==null?void 0:i.unit_type)&&((i==null?void 0:i.unit_type)==="WEIGHT"?b(!1):(i==null?void 0:i.unit_type)==="PIECE"?b(!0):((i==null?void 0:i.unit_type)==="LIQUID"||(i==null?void 0:i.unit_type)==="LENGTH")&&b(!1))}if("package_quantity"in a){const x=a.package_quantity,i=(_=e==null?void 0:e.form)==null?void 0:_.getFieldValue("target_quantity");x>0&&i>0?I(Math.ceil(i/x)):I(0)}if("target_quantity"in a){const x=(y=e==null?void 0:e.form)==null?void 0:y.getFieldValue("package_quantity"),i=a.target_quantity;x>0&&i>0?I(Math.ceil(i/x)):I(0)}"unit_type"in a&&(a.unit_type==="WEIGHT"?(V(w),(n=e==null?void 0:e.form)==null||n.setFieldsValue({unit_weight_type:w[0].value}),b(!1),(m=e==null?void 0:e.form)==null||m.setFieldsValue({unit_weight:0})):a.unit_type==="PIECE"?(V(w),(c=e==null?void 0:e.form)==null||c.setFieldsValue({unit_weight_type:w[0].value}),b(!0),(f=e==null?void 0:e.form)==null||f.setFieldsValue({unit_weight:0})):a.unit_type==="LIQUID"?(V(A),(o=e==null?void 0:e.form)==null||o.setFieldsValue({unit_weight_type:A[0].value}),b(!1),(q=e==null?void 0:e.form)==null||q.setFieldsValue({unit_weight:0})):a.unit_type==="LENGTH"&&(V(N),(R=e==null?void 0:e.form)==null||R.setFieldsValue({unit_weight_type:N[0].value}),b(!1),(W=e==null?void 0:e.form)==null||W.setFieldsValue({unit_weight:0})))},X=a=>{var u,r,p,_,y;if(a){const n=(r=(u=j==null?void 0:j.data)==null?void 0:u.data)==null?void 0:r.find(c=>c.id===a);(p=e==null?void 0:e.form)==null||p.setFieldsValue({customer:n==null?void 0:n.customer,po_category:n==null?void 0:n.po_category}),(_=e==null?void 0:e.form)==null||_.setFieldsValue({customer:n==null?void 0:n.customer});const m=(y=n==null?void 0:n.items)==null?void 0:y.map(c=>c.product_id);m&&T(m)}else T([])},Y=a=>{var u,r,p,_,y,n,m;if(a){const c=(u=e==null?void 0:e.form)==null?void 0:u.getFieldValue(["joborder","id"]);if(c){const f=(p=(r=j==null?void 0:j.data)==null?void 0:r.data)==null?void 0:p.find(q=>q.id===c),o=(_=f==null?void 0:f.items)==null?void 0:_.find(q=>q.product_id===a);(y=e==null?void 0:e.form)==null||y.setFieldsValue({target_quantity:o==null?void 0:o.quantity}),(n=e==null?void 0:e.form)==null||n.setFieldsValue({joborder_item:{id:o==null?void 0:o.id}})}else(m=e==null?void 0:e.form)==null||m.setFieldsValue({joborder_item:null})}},S=v.useMemo(()=>{var a,u;return F.length>0?(a=C.data)==null?void 0:a.data.filter(r=>F.includes(r.id)):(u=C.data)==null?void 0:u.data},[(E=C.data)==null?void 0:E.data,F]);return t.jsx(ee,{saveButtonProps:B,children:t.jsx(s,{...e,onValuesChange:J,initialValues:{batch_date:null,unit_weight:0,product_type:te[0].value,unit_type:Q[0].value,unit_weight_type:w[0].value,status:1,process_status:1,customer:{}},onFinish:a=>{let{joborder:u,joborder_item:r}=a;return(u==null?void 0:u.id)===void 0&&(u=null),(r==null?void 0:r.id)===void 0&&(r=null),e.onFinish&&e.onFinish({...a,joborder:u,joborder_item:r})},layout:"vertical",children:t.jsx(U,{defaultActiveKey:"1",children:t.jsx(U.TabPane,{tab:l("batchlabels.tabs.basic"),forceRender:!0,children:t.jsxs(ae,{gutter:24,children:[t.jsxs(d,{span:12,children:[t.jsx(s.Item,{label:l("batchlabels.fields.joborder"),name:["joborder","id"],children:t.jsx(h,{placeholder:l("batchlabels.fields.joborder"),...D,onChange:X,allowClear:!0,onSearch:void 0,filterOption:!0,optionFilterProp:"label"})}),t.jsx(s.Item,{hidden:!0,name:["joborder_item","id"],children:t.jsx(g,{})})]}),t.jsxs(d,{span:12,children:[F.length>0&&t.jsx(s.Item,{label:l("batchlabels.fields.customer"),children:t.jsx(g,{readOnly:!0,disabled:!0,value:(k=e==null?void 0:e.form)==null?void 0:k.getFieldValue(["customer","name"])})}),t.jsx(s.Item,{hidden:F.length>0,label:l("batchlabels.fields.customer"),name:["customer","id"],rules:[{required:!0,message:l("rules.requiredOption")}],children:t.jsx(h,{placeholder:l("batchlabels.fields.customer"),...z,allowClear:!0,onSearch:void 0,filterOption:!0,optionFilterProp:"label"})})]}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.product"),name:["product","id"],rules:[{required:!0,message:l("rules.requiredOption")}],children:t.jsx(h,{placeholder:l("batchlabels.fields.product"),...K,allowClear:!0,onSearch:void 0,filterOption:!0,optionFilterProp:"label",options:S==null?void 0:S.map(a=>({label:a.name,value:a.id})),onChange:Y})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.machine"),name:["machine","id"],rules:[{required:!0,message:l("rules.requiredOption")}],children:t.jsx(h,{placeholder:l("batchlabels.fields.machine"),...O,allowClear:!0,onSearch:void 0,filterOption:!0,optionFilterProp:"label"})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.batch_date"),name:["batch_date"],rules:[{required:!0}],children:t.jsx(le,{style:{width:"100%"}})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.batch_no"),name:["batch_no"],rules:[{required:!0}],children:t.jsx(g,{})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.so_number"),name:["so_number"],rules:[{required:!0}],children:t.jsx(g,{})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.unit_type"),name:["unit_type"],rules:[{required:!0}],children:t.jsx(h,{options:Q,placeholder:l("batchlabels.fields.unit_type")})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.unit_weight_type"),name:["unit_weight_type"],rules:[{required:!0}],children:t.jsx(h,{allowClear:!0,options:H,placeholder:l("batchlabels.fields.unit_weight_type")})})}),M&&t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.unit_weight"),name:["unit_weight"],rules:[{required:!0}],getValueFromEvent:a=>Number(a.target.value),children:t.jsx(g,{type:"number"})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.po_category"),name:["po_category"],rules:[{required:!0}],children:t.jsx(h,{allowClear:!0,options:ie,placeholder:l("batchlabels.fields.po_category")})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.target_quantity"),name:["target_quantity"],rules:[{required:!0}],getValueFromEvent:a=>Number(a.target.value),children:t.jsx(g,{type:"number"})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.package_quantity"),name:["package_quantity"],rules:[{required:!0}],getValueFromEvent:a=>Number(a.target.value),children:t.jsx(g,{type:"number"})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.status"),name:["status"],rules:[{required:!0}],children:t.jsx(h,{allowClear:!0,options:se,placeholder:l("batchlabels.fields.status")})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.process_status"),name:["process_status"],rules:[{required:!0}],children:t.jsx(h,{allowClear:!0,options:ne,placeholder:l("batchlabels.fields.process_status")})})}),t.jsx(d,{span:12,children:t.jsx(s.Item,{label:l("batchlabels.fields.stickersToPrint"),children:t.jsx(g,{type:"number",disabled:!0,value:G})})})]})},"1")})})})};export{re as BatchlabelCreate,re as default};
