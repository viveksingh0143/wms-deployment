import{_ as J,r as p,T as X,$ as Y,R as Z,y as x,z as L,A as T,j as t,V as P,F as n,L as $,E as O,J as v,m as ee,n as _,S as m,I as y,f as te,C as ie,d as C,B as le,g as F}from"./index-7ade8dfe.js";import{c as ne,g as se,C as de}from"./converters-a3674b07.js";import{M as re}from"./MinusCircleOutlined-f6a845b7.js";const oe=()=>{const l=J(),[j,E]=p.useState([]),[G,H]=p.useState([]),[M,I]=p.useState(!1),[V,g]=p.useState([]),[U,h]=p.useState(!1),[S,k]=p.useState(!0),{formProps:e,formLoading:A,saveButtonProps:B}=X({}),{data:w,isLoading:D}=Y({resource:"categories",filters:[{field:"query",operator:"eq",value:"/products/"}],queryOptions:{enabled:j.length<=0}});p.useEffect(()=>{var i;if(j.length<=0){let s=ne((w==null?void 0:w.data)||[],null,null);s.length>0&&s[0].children&&((i=s[0].children)==null?void 0:i.length)>0?E(s[0].children):E([])}},[w,D]);const{selectProps:K,queryResult:q}=Z({resource:"products",optionLabel:"name",optionValue:"id"}),Q=i=>{var s,u,c,d,r,a,o,f,b,R,W,N;"name"in i&&((u=e==null?void 0:e.form)==null||u.setFieldsValue({slug:F(i.name)+"-"+F((s=e==null?void 0:e.form)==null?void 0:s.getFieldValue("code"))})),"code"in i&&((d=e==null?void 0:e.form)==null||d.setFieldsValue({slug:F((c=e==null?void 0:e.form)==null?void 0:c.getFieldValue("name"))+"-"+F(i.code)})),"unit_type"in i&&(i.unit_type==="WEIGHT"?(g(x),(r=e==null?void 0:e.form)==null||r.setFieldsValue({unit_weight_type:x[0].value}),h(!1),(a=e==null?void 0:e.form)==null||a.setFieldsValue({unit_weight:0})):i.unit_type==="PIECE"?(g(x),(o=e==null?void 0:e.form)==null||o.setFieldsValue({unit_weight_type:x[0].value}),h(!0),(f=e==null?void 0:e.form)==null||f.setFieldsValue({unit_weight:0})):i.unit_type==="LIQUID"?(g(L),(b=e==null?void 0:e.form)==null||b.setFieldsValue({unit_weight_type:L[0].value}),h(!1),(R=e==null?void 0:e.form)==null||R.setFieldsValue({unit_weight:0})):i.unit_type==="LENGTH"&&(g(T),(W=e==null?void 0:e.form)==null||W.setFieldsValue({unit_weight_type:T[0].value}),h(!1),(N=e==null?void 0:e.form)==null||N.setFieldsValue({unit_weight:0}))),"product_type"in i&&(i.product_type==="RAW MATERIAL"?(H(i.ingredients),i.ingredients=[],I(!1)):(i.ingredients&&i.ingredients.length>0||(i.ingredients=G),I(!0)))};p.useEffect(()=>{var i,s,u,c,d;if(!A&&S){const r=(i=e==null?void 0:e.form)==null?void 0:i.getFieldValue("unit_type");r==="WEIGHT"?(g(x),h(!1)):r==="PIECE"?(g(x),h(!0),(s=e==null?void 0:e.form)==null||s.setFieldsValue({unit_weight:0})):r==="LIQUID"?(g(L),h(!1),(u=e==null?void 0:e.form)==null||u.setFieldsValue({unit_weight:0})):r==="LENGTH"&&(g(T),h(!1),(c=e==null?void 0:e.form)==null||c.setFieldsValue({unit_weight:0}));const a=(d=e==null?void 0:e.form)==null?void 0:d.getFieldValue("product_type");I(a!=="RAW MATERIAL"),k(!1)}},[A,e,S]);const z=(i,s)=>{var c,d,r,a;const{ingredients:u}=(c=e==null?void 0:e.form)==null?void 0:c.getFieldsValue(["ingredients"]);u[s].ingredient_id=i,u[s].ingredient=(r=(d=q==null?void 0:q.data)==null?void 0:d.data)==null?void 0:r.find(o=>o.id===i),(a=e==null?void 0:e.form)==null||a.setFieldsValue({ingredients:u})};return t.jsx(P,{saveButtonProps:B,children:t.jsx(n,{...e,onValuesChange:Q,layout:"vertical",initialValues:{unit_weight:0,product_type:$[0].value,unit_type:O[0].value,unit_weight_type:x[0].value,status:1},children:t.jsxs(v,{defaultActiveKey:"1",children:[t.jsx(v.TabPane,{tab:l("products.tabs.basic"),forceRender:!0,children:t.jsxs(ee,{gutter:24,children:[t.jsx(_,{span:12,children:t.jsx(n.Item,{label:l("products.fields.product_type"),name:["product_type"],rules:[{required:!0}],children:t.jsx(m,{allowClear:!0,options:$,placeholder:l("products.fields.product_type")})})}),t.jsx(_,{span:12,children:t.jsx(n.Item,{label:l("products.fields.category"),name:["category","id"],rules:[{required:!0}],getValueProps:i=>i?{value:se(i,j)}:{value:null},getValueFromEvent:i=>i?i[i.length-1]:null,children:t.jsx(de,{options:j,fieldNames:{label:"name",value:"id",children:"children"},expandTrigger:"hover",changeOnSelect:!0,allowClear:!0})})}),t.jsx(_,{span:12,children:t.jsx(n.Item,{label:l("products.fields.name"),name:["name"],rules:[{required:!0}],children:t.jsx(y,{})})}),t.jsx(n.Item,{hidden:!0,label:`${l("products.fields.slug")} (${l("common.fields.auto_fill")})`,name:["slug"],children:t.jsx(y,{placeholder:l("common.placeholders.auto_fill")})}),t.jsx(_,{span:12,children:t.jsx(n.Item,{label:l("products.fields.code"),name:["code"],rules:[{required:!0}],children:t.jsx(y,{})})}),t.jsx(n.Item,{hidden:!0,label:`${l("products.fields.cms_code")} (${l("common.fields.optional")})`,name:["cms_code"],children:t.jsx(y,{placeholder:l("common.placeholders.optional")})}),t.jsx(_,{span:24,children:t.jsx(n.Item,{label:l("products.fields.description"),name:["description"],rules:[{required:!0}],children:t.jsx(y.TextArea,{})})}),t.jsx(_,{span:12,children:t.jsx(n.Item,{label:l("products.fields.unit_type"),name:["unit_type"],rules:[{required:!0}],children:t.jsx(m,{allowClear:!0,options:O,placeholder:l("products.fields.unit_type")})})}),U?t.jsx(_,{span:12,children:t.jsxs(te,{style:{width:"100%"},children:[t.jsx(n.Item,{label:l("products.fields.unit_weight"),name:["unit_weight"],rules:[{required:!0}],getValueFromEvent:i=>Number(i.target.value),children:t.jsx(y,{type:"number"})}),t.jsx(n.Item,{label:l("products.fields.unit_weight_type"),name:["unit_weight_type"],rules:[{required:!0}],children:t.jsx(m,{allowClear:!0,options:V,placeholder:l("products.fields.unit_weight_type")})})]})}):t.jsx(_,{span:12,children:t.jsx(n.Item,{label:l("products.fields.unit_weight_type"),name:["unit_weight_type"],rules:[{required:!0}],children:t.jsx(m,{allowClear:!0,options:V,placeholder:l("products.fields.unit_weight_type")})})}),t.jsx(n.Item,{hidden:!0,label:l("products.fields.status"),name:["status"],rules:[{required:!0}],children:t.jsx(m,{allowClear:!0,options:ie,placeholder:l("products.fields.status")})})]})},"1"),t.jsx(v.TabPane,{tab:l("products.tabs.ingredients"),disabled:!M,forceRender:!0,children:t.jsx(n.List,{name:["ingredients"],children:(i,{add:s,remove:u})=>t.jsxs(t.Fragment,{children:[t.jsxs(C,{dataSource:i,pagination:!1,rowKey:"key",children:[t.jsx(C.Column,{title:l("products.ingredients.fields.ingredient"),dataIndex:"ingredient_id",render:(c,d,r)=>t.jsx(n.Item,{name:[d.name,"ingredient_id"],rules:[{required:!0,message:l("rules.requiredOption")}],children:t.jsx(m,{placeholder:l("products.ingredients.placeholders.ingredient"),...K,onChange:a=>z(a,d.name)})})},"ingredient_id"),t.jsx(C.Column,{title:l("products.ingredients.fields.quantity"),dataIndex:"quantity",render:(c,d,r)=>{var f;const a=(f=e==null?void 0:e.form)==null?void 0:f.getFieldValue(["ingredients",d.name,"ingredient"]);let o=a==null?void 0:a.unit_type;return o&&o!=="PIECE"&&(o=a.unit_weight_type),t.jsx(n.Item,{name:[d.name,"quantity"],rules:[{required:!0}],getValueFromEvent:b=>Number(b.target.value),children:t.jsx(y,{type:"number",placeholder:l("products.ingredients.placeholders.quantity"),addonAfter:o})})}},"quantity"),t.jsx(C.Column,{title:l("table.actions"),dataIndex:"action",render:(c,d,r)=>t.jsx(n.Item,{children:t.jsx(re,{onClick:()=>u(r)})})})]}),t.jsx(le,{type:"dashed",onClick:()=>s(),style:{width:"100%"},children:l("products.ingredients.buttons.add")})]})})},"2")]})})})};export{oe as ProductCreate,oe as default};
