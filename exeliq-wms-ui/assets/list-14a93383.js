import{_ as k,r as f,$ as A,a as M,b as V,c as G,P as W,d as c,j as e,e as H,K as q,G as Y,f as L,D as $,w as U,H as J,h as P,Y as Q,i as T,F as p,I as E,B as w,k as O,l as R,m as X,n as _,o as Z,S as ee,C as te,p as ae}from"./index-7ade8dfe.js";import{c as D,g as se,C as le}from"./converters-a3674b07.js";const{RangePicker:re}=ae,he=()=>{const s=k(),[n,l]=f.useState(),[i,m]=f.useState([]),{data:u,isLoading:j}=A({resource:"categories",filters:[{field:"query",operator:"eq",value:"/materials/"}],queryOptions:{enabled:i.length<=0}});f.useEffect(()=>{var t;if(i.length<=0){let a=D((u==null?void 0:u.data)||[],null,null);a.length>0&&a[0].children&&((t=a[0].children)==null?void 0:t.length)>0&&n===void 0?(l(a[0].children[0].full_path),m(a[0].children)):m([])}},[u,j]);const{tableProps:o,searchFormProps:d}=M({syncWithLocation:!0,filters:{permanent:[{field:"product_type",operator:"eq",value:"RAW MATERIAL"},{field:"category_path_startswith",operator:"startswith",value:n}]},queryOptions:{enabled:n!==void 0},onSearch:t=>{const a=[],{q:x,name:C,slug:v,code:B,cms_code:oe,category_id:K,status:de,createdAt:S}=t;return a.push({field:"query",operator:"eq",value:x},{field:"name",operator:"eq",value:C},{field:"code",operator:"eq",value:B},{field:"category_id",operator:"eq",value:K},{field:"createdAt",operator:"gte",value:S?S[0].toISOString():void 0},{field:"createdAt",operator:"lte",value:S?S[1].toISOString():void 0}),a}}),{triggerExport:I,isLoading:b}=V({mapData:t=>{var a;return{id:t.id,name:t.name,slug:t.slug,code:t.code,cms_code:t.cms_code,description:t.description,unit_type:t.unit_type,unit_weight:t.unit_weight,unit_weight_type:t.unit_weight_type,status:t.status,category:((a=t==null?void 0:t.category)==null?void 0:a.name)||""}}}),[r,y]=G.useState([]),{mutate:g,isLoading:h}=W(),F=()=>{g({resource:"products",ids:r.map(String)},{onSuccess:()=>{y([])}})},N={selectedRowKeys:r,onChange:t=>{y(t)},selections:[c.SELECTION_ALL,c.SELECTION_INVERT,c.SELECTION_NONE]},z=t=>{var a,x;l(t),(a=d==null?void 0:d.form)==null||a.resetFields(),(x=d==null?void 0:d.form)==null||x.submit()};return e.jsxs(H,{title:e.jsx(e.Fragment,{children:n!==void 0&&e.jsx(q.Group,{onChange:t=>z(t.target.value),defaultValue:n,buttonStyle:"solid",children:i==null?void 0:i.map(t=>e.jsx(q.Button,{value:t.full_path,children:t.name},t.id))})}),headerButtons:({defaultButtons:t})=>e.jsxs(e.Fragment,{children:[t,e.jsx(Y,{onClick:I,loading:b})]}),headerProps:{subTitle:e.jsx(L,{children:e.jsx($,{selectedKeys:r,isLoading:h,onDelete:F})})},children:[e.jsx(ne,{formProps:d,categorySelected:n}),e.jsxs(c,{...o,rowSelection:N,rowKey:"id",pagination:{...o.pagination,showSizeChanger:!0},expandable:{expandedRowRender:t=>{const a=[{key:"3",label:s("materials.fields.unit_type"),children:t.unit_type},{key:"4",label:s("materials.fields.unit_weight"),children:t.unit_weight+t.unit_weight_type},{key:"5",label:s("materials.fields.description"),children:t.description,span:2}];return e.jsx(U,{bordered:!0,items:a})}},children:[e.jsx(c.Column,{title:s("table.s_no"),render:(t,a,x)=>{let C=1,v=10;return typeof o.pagination=="object"&&(C=o.pagination.current??1,v=o.pagination.pageSize??10),(C-1)*v+x+1}},"index"),e.jsx(c.Column,{dataIndex:"name",title:s("materials.fields.name"),sorter:!0}),e.jsx(c.Column,{dataIndex:"code",title:s("materials.fields.code"),sorter:!0}),e.jsx(c.Column,{dataIndex:["category","name"],title:s("materials.fields.category"),sorter:!0}),e.jsx(c.Column,{title:s("table.actions"),dataIndex:"actions",render:(t,a)=>e.jsxs(L,{children:[e.jsx(J,{hideText:!0,size:"small",recordItemId:a.id}),e.jsx(P,{hideText:!0,size:"small",recordItemId:a.id}),e.jsx(Q,{hideText:!0,size:"small",recordItemId:a.id})]})})]})]})},ne=({formProps:s,categorySelected:n})=>{const l=k(),[i,m]=f.useState(!0),[u,j]=f.useState([]),{data:o,isLoading:d}=A({resource:"categories",filters:[{field:"query",operator:"eq",value:"/materials/"}]});f.useEffect(()=>{var r;if(n){const y=o==null?void 0:o.data.filter(h=>h.full_path.startsWith(n)).map(h=>(h.full_path===n&&(h.parent=void 0),h));let g=D(y||[],null,null);g.length>0&&g[0].children&&((r=g[0].children)==null?void 0:r.length)>0?j(g):j([])}},[o,d,n]);const I=()=>e.jsx(T,{title:e.jsx(p,{layout:"inline",...s,onFinish:s==null?void 0:s.onFinish,children:e.jsx(p.Item,{name:"q",style:{width:"100%"},children:e.jsx(E.Search,{placeholder:l("filter.placeholders.query"),enterButton:l("filter.buttons.search")})})}),extra:e.jsx(w,{type:"text",onClick:()=>m(!i),children:i?e.jsx(O,{}):e.jsx(R,{})}),bodyStyle:{padding:"0px"}}),b=()=>e.jsx(T,{title:l("filter.title"),extra:e.jsx(w,{onClick:()=>m(!i),type:"text",children:i?e.jsx(O,{}):e.jsx(R,{})}),children:e.jsxs(p,{layout:"vertical",...s,children:[e.jsxs(X,{gutter:24,children:[e.jsx(_,{span:6,children:e.jsx(p.Item,{label:l("filter.fields.query"),name:"q",children:e.jsx(E,{placeholder:l("filter.placeholders.query"),prefix:e.jsx(Z,{})})})}),e.jsx(_,{span:6,children:e.jsx(p.Item,{label:l("materials.fields.status"),name:"status",children:e.jsx(ee,{allowClear:!0,options:te,placeholder:l("materials.placeholders.status")})})}),u.length>0&&e.jsx(_,{span:6,children:e.jsx(p.Item,{label:l("materials.fields.category"),name:"category_id",getValueProps:r=>r?{value:se(r,u)}:{value:null},getValueFromEvent:r=>r?r[r.length-1]:null,children:e.jsx(le,{options:u,fieldNames:{label:"name",value:"id",children:"children"},expandTrigger:"hover",changeOnSelect:!0,allowClear:!0})})}),e.jsx(_,{span:6,children:e.jsx(p.Item,{label:l("filter.fields.created_at"),name:"createdAt",children:e.jsx(re,{})})})]}),e.jsx(p.Item,{children:e.jsx(w,{htmlType:"submit",type:"primary",children:l("filter.buttons.search")})})]})});return i?I():b()};export{he as MaterialList,he as default};
